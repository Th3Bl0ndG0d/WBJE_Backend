sequenceDiagram
    autonumber

    actor Client
    participant JobController
    participant JobService
    participant JobRepository
    participant JobDTOMapper

%% =================================================
%% 1) Happy flow
%% =================================================
    Client->>JobController: GET /jobs/{id}
    activate JobController

    JobController->>JobService: getJobById(id)
    activate JobService

    JobService->>JobRepository: findById(id)
    activate JobRepository
    JobRepository-->>JobService: Optional<JobEntity>
    deactivate JobRepository

    Note right of JobService: JobEntity wordt opgehaald via<br/>@EntityGraph in JobRepository,<br/>waardoor cylinders en reports<br/>binnen dezelfde query worden geladen<br/>


    JobService->>JobDTOMapper: toResponseDTO(JobEntity)
    activate JobDTOMapper
    JobDTOMapper-->>JobService: JobResponseDTO
    deactivate JobDTOMapper

    JobService-->>JobController: JobResponseDTO
    deactivate JobService

    JobController-->>Client: 200 OK (application/json)
    deactivate JobController

%% =================================================
%% 2) Alternative flow: Job not found (404)
%% =================================================
    alt Job not found
        Client->>JobController: GET /jobs/{id}
        activate JobController

        JobController->>JobService: getJobById(id)
        activate JobService

        JobService->>JobRepository: findById(id)
        activate JobRepository
        JobRepository-->>JobService: Optional.empty()
        deactivate JobRepository

        JobService-->>JobController: throws ResourceNotFoundException
        deactivate JobService

        JobController-->>Client: 404 Not Found (via GlobalExceptionHandler)
        deactivate JobController
    end
